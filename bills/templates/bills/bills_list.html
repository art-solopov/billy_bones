{% extends "base.html" %}
{% load datetime_operations %}
{% load bills_formatting %}


{% block content %}
    <header class="row">
	<h1>Bills</h1>
    </header>

    <div class="row">
	<div class="col-sm-12">
	    <!-- TODO: crispy forms -->
	    <form action="" method="GET">
		{{ bills_filter.form.as_p }}
		<input type="Submit" value="Search" />
	    </form>
	</div>
    </div>

    <div class="row pd-y-1">
	<div class="col-sm-12">
	    <a href="{% url 'bills:new' %}" class="btn btn-success">Create bill</a>
	</div>
    </div>

    <div class="row">
	<div class="col-sm-12">
	    <table class="table table-striped">
		{% for bill in object_list %}
		    <tr>
			<td>{{ bill.id }}</td>
			<td>{{ bill.period | format_period }}</td>
			<td>{{ bill | state_str | safe }}</td>
			<td>
			    {% if bill.payment_method %}
				{{ bill.payment_method.name }}
			    {% endif %}
			</td>
			<td>{{ bill.cost }}</td>
			<td>{{ bill.created | format_date_long }}</td>
			<td>{{ bill.paid | format_date_long }}</td>
			<td>{{ bill.printed | format_date_long }}</td>
			<td>{{ bill | tag_names }}
			    <td>
				<a href="{% url 'bills:edit' pk=bill.id %}">Edit</a>
				{% for tr in bill.get_available_state_i_transitions %}
				    <a href="{% url 'bills:edit' pk=bill.id action=tr.name %}">{{ tr | transition_str }}</a>
				{% endfor %}
				<a href="{% url 'bills:delete' pk=bill.id %}">Delete</a>
			    </td>
		    </tr>
		{% endfor %}
	    </table>
	</div>
    </div>
    

{% endblock %}
